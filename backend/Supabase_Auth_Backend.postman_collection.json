{
	"info": {
		"_postman_id": "supabase-auth-backend",
		"name": "Supabase Auth Backend",
		"description": "Complete authentication API collection for Supabase backend with hybrid cookie/header auth support",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/",
					"host": [
						"{{base_url}}"
					],
					"path": [
						""
					]
				},
				"description": "Check if server is running and see available endpoints"
			},
			"response": []
		},
		{
			"name": "Auth - Sign Up",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/auth/signup",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"auth",
						"signup"
					]
				},
				"description": "Register a new user account"
			},
			"response": []
		},
		{
			"name": "Auth - Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Save access token to environment variable for header-based auth",
							"if (pm.response.code === 200) {",
							"    const response = pm.response.json();",
							"    if (response.session && response.session.access_token) {",
							"        pm.environment.set('access_token', response.session.access_token);",
							"        console.log('Access token saved to environment');",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/auth/login",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"auth",
						"login"
					]
				},
				"description": "Login user and set HTTP-only cookie + save token for header auth"
			},
			"response": []
		},
		{
			"name": "Auth - Get Current User (Cookie)",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/auth/me",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"auth",
						"me"
					]
				},
				"description": "Get current user using HTTP-only cookie (requires login first)"
			},
			"response": []
		},
		{
			"name": "Auth - Get Current User (Header)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/profile",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"profile"
					]
				},
				"description": "Get current user using Authorization header (requires login first to get token)"
			},
			"response": []
		},
		{
			"name": "Auth - Logout",
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{base_url}}/auth/logout",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"auth",
						"logout"
					]
				},
				"description": "Logout user and clear HTTP-only cookie"
			},
			"response": []
		},
		{
			"name": "Test - Protected Route (Cookie)",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/profile",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"profile"
					]
				},
				"description": "Test protected route using cookie authentication"
			},
			"response": []
		},
		{
			"name": "Test - Protected Route (Header)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"url": {
					"raw": "{{base_url}}/profile",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"profile"
					]
				},
				"description": "Test protected route using Authorization header"
			},
			"response": []
		},
		{
			"name": "Test - Invalid Token",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer invalid_token_here"
					}
				],
				"url": {
					"raw": "{{base_url}}/profile",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"profile"
					]
				},
				"description": "Test error handling with invalid token"
			},
			"response": []
		},
		{
			"name": "Test - No Authentication",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/profile",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"profile"
					]
				},
				"description": "Test error handling when no authentication is provided"
			},
			"response": []
		},
		{
			"name": "AI - Generate Plan (Protected)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"focus\": \"Learn React\",\n  \"outcome\": \"Build a production app\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/ai/complete",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"ai",
						"complete"
					]
				},
				"description": "Generate a study plan from focus/outcome via OpenAI and persist. Requires login to populate {{access_token}}."
			},
			"response": []
		},
		{
			"name": "AI - List My Plans",
			"request": {
				"method": "GET",
				"header": [
					{ "key": "Authorization", "value": "Bearer {{access_token}}" }
				],
				"url": { "raw": "{{base_url}}/ai/plans", "host": ["{{base_url}}"], "path": ["ai","plans"] },
				"description": "List study plans for current user"
			},
			"response": []
		},
		{
			"name": "AI - Get Latest Plan",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/plans/latest", "host": ["{{base_url}}"], "path": ["ai","plans","latest"] },
				"description": "Fetch latest plan with nested milestones/steps/resources"
			},
			"response": []
		},
		{
			"name": "AI - Get Plan By ID",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/plans/{{plan_id}}", "host": ["{{base_url}}"], "path": ["ai","plans","{{plan_id}}"] },
				"description": "Fetch specific plan (must belong to user)"
			},
			"response": []
		},
		{
			"name": "AI - Update Plan",
			"request": {
				"method": "PUT",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"title\": \"New Title\",\n  \"focus\": \"...\",\n  \"outcome\": \"...\",\n  \"estimated_duration_weeks\": 8\n}" },
				"url": { "raw": "{{base_url}}/ai/plans/{{plan_id}}", "host": ["{{base_url}}"], "path": ["ai","plans","{{plan_id}}"] },
				"description": "Update plan basic fields"
			},
			"response": []
		},
		{
			"name": "AI - Delete Plan",
			"request": {
				"method": "DELETE",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/plans/{{plan_id}}", "host": ["{{base_url}}"], "path": ["ai","plans","{{plan_id}}"] },
				"description": "Delete plan and related data"
			},
			"response": []
		},
		{
			"name": "AI - Add Milestone",
			"request": {
				"method": "POST",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"title\": \"Foundations\",\n  \"description\": \"Basics\",\n  \"estimated_duration\": \"2 weeks\"\n}" },
				"url": { "raw": "{{base_url}}/ai/plans/{{plan_id}}/milestones", "host": ["{{base_url}}"], "path": ["ai","plans","{{plan_id}}","milestones"] },
				"description": "Create milestone on a plan"
			},
			"response": []
		},
		{
			"name": "AI - Update Milestone",
			"request": {
				"method": "PUT",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"title\": \"Updated\",\n  \"description\": \"...\"\n}" },
				"url": { "raw": "{{base_url}}/ai/milestones/{{milestone_id}}", "host": ["{{base_url}}"], "path": ["ai","milestones","{{milestone_id}}"] },
				"description": "Update milestone"
			},
			"response": []
		},
		{
			"name": "AI - Delete Milestone",
			"request": {
				"method": "DELETE",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/milestones/{{milestone_id}}", "host": ["{{base_url}}"], "path": ["ai","milestones","{{milestone_id}}"] },
				"description": "Delete milestone"
			},
			"response": []
		},
		{
			"name": "AI - Add Step",
			"request": {
				"method": "POST",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"title\": \"Read Docs\",\n  \"description\": \"react.dev\"\n}" },
				"url": { "raw": "{{base_url}}/ai/milestones/{{milestone_id}}/steps", "host": ["{{base_url}}"], "path": ["ai","milestones","{{milestone_id}}","steps"] },
				"description": "Create step on a milestone"
			},
			"response": []
		},
		{
			"name": "AI - Update Step",
			"request": {
				"method": "PUT",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"title\": \"Updated Step\",\n  \"description\": \"...\"\n}" },
				"url": { "raw": "{{base_url}}/ai/steps/{{step_id}}", "host": ["{{base_url}}"], "path": ["ai","steps","{{step_id}}"] },
				"description": "Update step"
			},
			"response": []
		},
		{
			"name": "AI - Delete Step",
			"request": {
				"method": "DELETE",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/steps/{{step_id}}", "host": ["{{base_url}}"], "path": ["ai","steps","{{step_id}}"] },
				"description": "Delete step"
			},
			"response": []
		},
		{
			"name": "AI - Add Resource",
			"request": {
				"method": "POST",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"type\": \"link\",\n  \"title\": \"React Docs\",\n  \"url\": \"https://react.dev\"\n}" },
				"url": { "raw": "{{base_url}}/ai/steps/{{step_id}}/resources", "host": ["{{base_url}}"], "path": ["ai","steps","{{step_id}}","resources"] },
				"description": "Create resource on a step"
			},
			"response": []
		},
		{
			"name": "AI - Update Resource",
			"request": {
				"method": "PUT",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"type\": \"video\",\n  \"title\": \"Updated Title\",\n  \"url\": \"https://example.com\"\n}" },
				"url": { "raw": "{{base_url}}/ai/resources/{{resource_id}}", "host": ["{{base_url}}"], "path": ["ai","resources","{{resource_id}}"] },
				"description": "Update resource"
			},
			"response": []
		},
		{
			"name": "AI - Delete Resource",
			"request": {
				"method": "DELETE",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/resources/{{resource_id}}", "host": ["{{base_url}}"], "path": ["ai","resources","{{resource_id}}"] },
				"description": "Delete resource"
			},
			"response": []
		},
		{
			"name": "Public - List Plans",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/plans/public", "host": ["{{base_url}}"], "path": ["ai","plans","public"] },
				"description": "List public plans (excludes current user)"
			},
			"response": []
		},
		{
			"name": "Public - Get Plan By ID",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/plans/public/{{plan_id}}", "host": ["{{base_url}}"], "path": ["ai","plans","public","{{plan_id}}"] },
				"description": "Read-only public plan detail"
			},
			"response": []
		},
		{
			"name": "Public - Bookmark Plan",
			"request": {
				"method": "POST",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/public/plans/{{plan_id}}/bookmark", "host": ["{{base_url}}"], "path": ["ai","public","plans","{{plan_id}}","bookmark"] },
				"description": "Bookmark a public plan"
			},
			"response": []
		},
		{
			"name": "Public - Unbookmark Plan",
			"request": {
				"method": "DELETE",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/public/plans/{{plan_id}}/bookmark", "host": ["{{base_url}}"], "path": ["ai","public","plans","{{plan_id}}","bookmark"] },
				"description": "Remove bookmark"
			},
			"response": []
		},
		{
			"name": "Public - List Bookmarks",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/bookmarks", "host": ["{{base_url}}"], "path": ["ai","bookmarks"] },
				"description": "List user's bookmarks with progress summary"
			},
			"response": []
		},
		{
			"name": "Public - Get Progress for Plan",
			"request": {
				"method": "GET",
				"header": [ { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"url": { "raw": "{{base_url}}/ai/public/plans/{{plan_id}}/progress", "host": ["{{base_url}}"], "path": ["ai","public","plans","{{plan_id}}","progress"] },
				"description": "Get completed milestone ids for current user on a public plan"
			},
			"response": []
		},
		{
			"name": "Public - Set Progress for Plan",
			"request": {
				"method": "POST",
				"header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{access_token}}" } ],
				"body": { "mode": "raw", "raw": "{\n  \"milestone_id\": \"{{milestone_id}}\",\n  \"completed\": true\n}" },
				"url": { "raw": "{{base_url}}/ai/public/plans/{{plan_id}}/progress", "host": ["{{base_url}}"], "path": ["ai","public","plans","{{plan_id}}","progress"] },
				"description": "Set/toggle milestone completion on a public plan for current user"
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3001",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		}
	]
}
